<% layout('layouts/dashboard.layout') %>

<% block('subTitle', 'Token History' ) %>

<% block('addon-style', `
  <link rel="stylesheet" href="${asset('vendor/datatables/css/datatables.min.css')}" nonce="${cspNonce}" />
  <style nonce="${cspNonce}">
    .dt-search label i {
      margin-right: 0.5rem !important;
    }
  </style>
`) %>

<h2 class="section-title"><i class="fas fa-history"></i> Token History</h2>

<div class="token-table-container">
  <table class="token-table">
    <thead>
      <tr>
        <th>Code</th>
        <th>Name</th>
        <th>Description</th>
        <th>Status</th>
        <th>Created At</th>
        <th>Redeemed At</th>
      </tr>
    </thead>
    <tbody>
      <% tokens.forEach((token) => { %>
        <tr>
          <td class="token-code"><%= token.code %></td>
          <td><%= token.name %></td>
          <td><%= token.description %></td>
          <td><span class="status-badge status-<%= token.status %>"><%= token.status %></span></td>
          <td class="timestamp"><%= token.createdAt ?? '-' %></td>
          <td class="timestamp"><%= token.redeemedAt ?? '-' %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<% block('addon-script', `
  <script src="${asset('vendor/datatables/js/datatables.min.js')}" nonce="${cspNonce}" defer></script>
  <script nonce="${cspNonce}">
    $(document).ready(function () {
      $.ajax({
        url: "${route('api/datatable/config')}",
        method: 'GET',
        dataType: 'json',
        success: function (data) {
          const table = $('.token-table').DataTable(data.data);
        },
        error: function (error) {
          console.error('Error fetching DataTable configuration:', error);
        }
      });
    });
  </script>
`) %>
